#!/bin/sh

echo "=== Pruebas de regresi√≥n al sistema con Javascript"

export PUERTODES=33001
export IPDES=127.0.0.1
export RAILS_ENV=test
export CONFIG_HOSTS=127.0.0.1

if (test ! -f .env) then {
  echo "Falta .env"
  exit 1;
} fi;
. ./.env

echo "=== Deteniendo"
bin/detiene

echo "=== Precompilando"
bin/rails assets:precompile

echo "=== Iniciando servidor"
CONFIG_HOSTS=127.0.0.1 R=f bin/corre &

sleep 10;

echo "***"
w3m -dump http://${IPDES}:${PUERTODES}
echo "***"

for i in test/puppeteer/*; do
  echo "Ejecutando $i"
  cat $i
  node $i
done

bin/detiene 

